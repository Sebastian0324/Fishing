{% extends "form.html" %}

{% block content %}{% if session.name %}
<div class="page-container">

    <!-- Account Name Title -->
    <div class="header-container">
        <h1 class="page-title">{{ session.name }}</h1>
        <button class="settings-cogwheel" onclick="toggleSettings()" aria-label="Open Settings">
            <i data-lucide="settings"></i>
        </button>
    </div>

    <!-- Uploaded Emails Section -->
    <div class="account-section uploaded-emails-section" id="emailsSection">
        <h3 class="section-header">Uploaded Emails</h3>
        <table class="uploads-table">
            <thead>
                <th>Title</th>
                <th>Last Updated</th>
                <th>Options</th>
                <th>Re-Analyze</th>
            </thead>
            <tbody>
            {% for eml_id, title, last_update in emails %}
                <tr>
                    <td>{{ title }}</td>
                    <td>{{ last_update }}</td>
                    <td>
                        <form id="eml-{{eml_id}}">
                            <div class="options-row">
                                <div class="options-group">
                                    <div class="options-group-inner">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="emlSwitch-{{eml_id}}" name="eml" value="1" role="switch" aria-checked="false">
                                            <label class="form-check-label" for="emlSwitch-{{eml_id}}">.eml</label>
                                        </div>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="analysisSwitch-{{eml_id}}" name="analysis" value="1" role="switch" aria-checked="false">
                                            <label class="form-check-label" for="analysisSwitch-{{eml_id}}">Analysis</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="download-wrap">
                                    <button type="submit" class="download-btn btn btn-sm btn-outline-secondary" title="Download">
                                        <i data-lucide="download-cloud" aria-hidden="true"></i>
                                        <span class="download-label">Download</span>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </td>
                    <td>
                        <button type="button" class="reanalyze-btn btn btn-sm btn-outline-primary" data-id="{{eml_id}}" title="Re-analyze" aria-label="Re-analyze">
                            <i data-lucide="refresh-cw" aria-hidden="true"></i>
                            <span style="margin-left:8px">Re-analyze</span>
                        </button>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    <!-- Settings Panel -->
    <div class="settings-panel" id="settingsPanel" style="display: none;">
        <div class="account-section">
            <div class="header-with-close">
                <h3 class="section-header">Account Settings</h3>
                <button class="close-login" onclick="toggleSettings()" aria-label="Close Settings">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="settings-content">
                <p>Change your account preferences here.</p>
            </div>
        </div>
    </div>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script>
        lucide.createIcons();
    </script>
</div>

{% else %}
<div class="page-container">    
    <div class="header-container">
        <h1 class="page-title">Access to this page requires you to be logged on.</h1>
    </div>
</div>
{% endif %}{% endblock %}
