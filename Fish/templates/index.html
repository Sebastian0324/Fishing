{% extends "form.html" %}
{% block content %}
    <div class="page-container">
        <!-- Page Title -->
        <h1 class="page-title">Welcome to Angler!</h1>

        <div class="layout">
            <!-- Left sidebar with Description -->
            <aside class="sidebar">
                <div class="content-section" id="welcomeSection">
                    <div class="welcome-header">
                        <h3 class="section-header">Description</h3>
                    </div>
                    <div class="placeholder-content">
                        <p>This site helps you learn how to spot phishing emails and safely analyze suspicious messages. Upload a .eml file to see an automated analysis, read community findings, and learn practical tips to protect yourself.</p>
                        <p>We believe learning from real examples is the best way to build strong habits. Your uploads stay private unless you choose to share, and the tools here are designed to teach, not to expose sensitive information.</p>
                        <p>Ready to explore? Use the controls on the right to upload an email or view a short guide on how the process works.</p>
                    </div>
                </div>
            </aside>

            <!-- Main content (upload form, analysis, toggles) -->
            <main class="main-content">
                <!-- Toggle Buttons: Upload <-> How It Works -->
                <div class="page-toggle-buttons">
                    <button id="showUploadBtn" class="toggle-btn active">Upload</button>
                    <button id="showHowBtn" class="toggle-btn">How it works</button>
                </div>
                
                <!-- Upload Form Section -->
                <div class="content-section upload-section">
                    <div id="uploadForm"> <!-- Before Uploade -->
                        <h3 class="section-header">Upload .eml File</h3>
                        <div class="placeholder-content">
                            <p class="placeholder-text">Select an email file to analyze for phishing threats</p>
                            <form method="post" enctype="multipart/form-data" action="/upload">

                                <div id="uploadControls" class="mb-3 form-check">
                                    <input type="file" class="form-control" name="file" accept=".eml" id="dropBox" multiple required/>
                                    
                                    <!-- Selected files preview -->
                                    <div id="selectedFiles" class="mt-2"></div>
                                </div>

                         <!-- Div for error messages before submit -->
                        <div id="SubmitError"></div>
                        <div class="mb-3 form-check">

                            <!-- AI Check Checkbox -->
                            <input type="checkbox" class="form-check-input" id="useAI" name="use_ai" value="1">
                            <label class="form-check-label" for="useAI"> <i class="bi bi-anthropic"></i> Check submitted file with AI (Add read more ) ?</label>
                        </div>
                        <button type="submit" id="submitButton" class="btn btn-primary">Submit</button>

                            </form>
                        </div>
                    </div>
                    <!-- Analysis Section - After Submit -->
                    <div id="analysis" class="hidden">
                        <div class="section-header">
                            <h3>Analyzing Your Email</h3>
                            <button id="ToUpload" type="reset" class="btn btn-secondary">
                                <i class="bi bi-arrow-left"></i> Back
                            </button>
                        </div>
                        
                        <div class="analysis-section">
                            
                            <!-- Loading Spinner -->
                            <div id="loadingSpinner" class="text-center my-4">
                                <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-3 text-muted">Please wait while we analyze your email for phishing threats...</p>
                            </div>
                            
                            <!-- Results Container -->
                            <div id="result"></div>
                            
                            <!-- Download Button -->
                            <div id="downloadSection" class="text-center mt-4 hidden">
                                <button type="button" id="downloadButton" class="btn btn-success btn-lg">
                                    <i class="bi bi-download"></i> Download Report
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- How It Works Section (moved from About Us) -->
                <div class="content-section" id="howItWorksSection" style="display: none;">
                    <h3 class="section-header">How It Works</h3>
                    <div class="placeholder-content">
                        <img src="{{ url_for('static', filename='how_to_temp.png') }}" alt="img of first page">
                    </div>
                </div>
            </main>
        </div>
    </div>
{% endblock %}
