{% extends "form.html" %}
{% block content %}
    <div class="page-container">
        <!-- Page Title -->
        <h1 class="page-title">Welcome to Angler!</h1>

        <div class="layout">
            <!-- Left sidebar with Description -->
            <aside class="sidebar" id="leftSidebar">
                <div class="content-section" id="welcomeSection">
                    <div class="welcome-header">
                        <h3 class="section-header">Description</h3>
                    </div>
                    <div class="placeholder-content" id="descriptionContent">
                        <p>This site helps you learn how to spot phishing emails and safely analyze suspicious messages. Upload a .eml file to see an automated analysis, read community findings, and learn practical tips to protect yourself.</p>
                        <p>We believe learning from real examples is the best way to build strong habits. Your uploads stay private unless you choose to share, and the tools here are designed to teach, not to expose sensitive information.</p>
                        <p>Ready to explore? Use the upload form to analyze an email and check the guide on the right for step-by-step instructions.</p>
                    </div>
                </div>
            </aside>

            <!-- Main content (upload form, analysis) -->
            <main class="main-content">
                <!-- Left Toggle Button -->
                <button class="sidebar-toggle left-toggle" id="leftToggle" onclick="toggleSidebar('left')">
                    <span id="leftToggleIcon">&lt;</span>
                    <span class="toggle-text" id="leftToggleText">Description</span>
                </button>

                <!-- Right Toggle Button -->
                <button class="sidebar-toggle right-toggle" id="rightToggle" onclick="toggleSidebar('right')">
                    <span id="rightToggleIcon">&gt;</span>
                    <span class="toggle-text" id="rightToggleText">How To</span>
                </button>

                <!-- Upload Form Section -->
                <div class="content-section upload-section">
                    <div id="uploadForm"> <!-- Before Uploade -->
                        <h3 class="section-header">Upload .eml File</h3>
                        <div class="placeholder-content">
                            <p class="placeholder-text">Select an email file to analyze for phishing threats</p>
                            <form method="post" enctype="multipart/form-data" action="/upload">

                                <div id="uploadControls" class="mb-3 form-check">
                                    <input type="file" class="form-control" name="file" accept=".eml" id="dropBox" multiple required/>
                                    
                                    <!-- Selected files preview -->
                                    <div id="selectedFiles" class="mt-2"></div>
                                </div>

                         <!-- Div for error messages before submit -->
                        <div id="SubmitError"></div>
                        <div class="mb-3">

                            <!-- AI Usage Information -->
                            <div style="margin-bottom: 1rem; padding: 0.75rem; font-size: 0.9rem; background: linear-gradient(135deg, rgba(110, 93, 198, 0.9), rgba(160, 81, 130, 0.9)); border: 2px solid rgba(255, 255, 255, 0.2); border-radius: 0.5em; color: white; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);">
                                <strong><i class="bi bi-info-circle"></i> About AI Analysis:</strong> When enabled, we use AI to help detect phishing patterns in your email. Your personal information is automatically anonymized before analysis. 
                                <a href="/AboutUs#ai-usage" style="text-decoration: underline; color: white;">Learn more about our AI usage and data privacy</a>
                            </div>

                            <!-- AI Check Checkbox -->
                            <div class="form-check" style="display: flex; justify-content: center; align-items: center;">
                                <input type="checkbox" class="form-check-input" id="useAI" name="use_ai" value="1">
                                <label class="form-check-label" for="useAI" style="margin-left: 0.5rem;"> <i class="bi bi-anthropic"></i> Enable AI-powered phishing detection</label>
                            </div>
                        </div>
                        <button type="submit" id="submitButton" class="btn btn-primary">Submit</button>

                            </form>
                        </div>
                    </div>
                    <!-- Analysis Section - After Submit -->
                    <div id="analysis" class="hidden">
                        <div class="section-header">
                            <h3>Analyzing Your Email</h3>
                            <button id="ToUpload" type="reset" class="btn btn-secondary">
                                <i class="bi bi-arrow-left"></i> Back
                            </button>
                        </div>
                        
                        <div class="analysis-section">
                            
                            <!-- Results Container -->
                            <div id="result"></div>
                            
                            <!-- Download Button -->
                            <div id="downloadSection" class="text-center mt-4 hidden">
                                <button type="button" id="downloadButton" class="btn btn-success btn-lg">
                                    <i class="bi bi-download"></i> Download Report
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Right sidebar with How To -->
            <aside class="sidebar" id="rightSidebar">
                <div class="content-section" id="howItWorksSection">
                    <div class="welcome-header">
                        <h3 class="section-header">How To</h3>
                    </div>
                    <div class="placeholder-content" id="howItWorksContent">
                        <h4 style="margin-bottom: 1rem;">Step-by-Step Guide:</h4>
                        <ol style="line-height: 1.8; margin-top: 0.5rem; padding-left: 1.2rem;">
                            <li style="margin-bottom: 0.8rem;"><strong>Choose Your File:</strong> Click the "Choose Files" button and select one or more .eml files from your computer.</li>
                            <li style="margin-bottom: 0.8rem;"><strong>Optional AI Analysis:</strong> Check the "Check submitted file with AI" box for enhanced phishing detection.</li>
                            <li style="margin-bottom: 0.8rem;"><strong>Submit for Analysis:</strong> Click the blue "Submit" button to upload your email(s).</li>
                            <li style="margin-bottom: 0.8rem;"><strong>Review Results:</strong> View the detailed report showing phishing indicators, sender info, links, and threat scores.</li>
                            <li style="margin-bottom: 0.8rem;"><strong>Download Report:</strong> Download a comprehensive PDF report of the findings.</li>
                        </ol>
                    </div>
                </div>
            </aside>
        </div>
    </div>
{% endblock %}
