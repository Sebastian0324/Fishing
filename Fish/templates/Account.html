{% extends "form.html" %}

{% block content %}{% if session.name %}
<div class="page-container">

    <!-- Account Name Title -->
    <div class="header-container">
        <h1 class="page-title">{{ session.name }}</h1>
        <button class="settings-cogwheel" onclick="toggleSettings()" aria-label="Open Settings">
            <i data-lucide="settings"></i>
        </button>
    </div>

    <!-- Uploaded Emails Section -->
    <div class="account-section uploaded-emails-section" id="emailsSection">
        <h3 class="section-header">Uploaded Emails</h3>
        <table>
            <thead>
                <th>Title</th>
                <th>Last Updated</th>
                <th>Options</th>
                <th>ReAnalys</th>
            </thead>
            <tbody>
            {% for eml_id, title, last_update in emails %}
                <tr>
                    <td>{{title}}</td>
                    <td>{{last_update}}</td>
                    <td><form id="eml-{{eml_id}}">
                        <input type="checkbox"><label>.eml</label> <input type="checkbox"><label>Analysis</label><button type="submit">Download</button>
                    </form></td>
                    <td>Re</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

  <!-- Settings Panel -->
<div class="settings-panel" id="settingsPanel" style="display: none;">
    <div class="account-section">
        <div class="header-with-close">
            <h3 class="section-header">Account Settings</h3>
            <button class="close-login" onclick="toggleSettings()" aria-label="Close Settings">
                <i data-lucide="x"></i>
            </button>
        </div>
                <div class="settings-content">
                        <p>Change your account preferences here.</p>

                        <!-- Change Password Form -->
                        <div class="card mt-3">
                            <div class="card-body">
                                <h5 class="card-title">Change Password</h5>
                                <form id="changePasswordForm">
                                    <div id="changePasswordError" class="mb-3" style="display:none"></div>
                                    <div id="changePasswordSuccess" class="mb-3" style="display:none"></div>

                                    <div class="mb-3">
                                        <label for="currentPassword" class="form-label">Current password</label>
                                        <input type="password" class="form-control" id="currentPassword" name="currentPassword" required>
                                    </div>

                                    <div class="mb-3">
                                        <label for="newPassword" class="form-label">New password</label>
                                        <input type="password" class="form-control" id="newPassword" name="newPassword" required>
                                    </div>
                                  
                                    <div class="mb-3">
                                        <label for="confirmPassword" class="form-label">Confirm new password</label>
                                        <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" required>
                                    </div>

                                    <div id="acc-password-match" class="mb-3 small text-muted" style="display:none">‚ùå Passwords do not match</div>

                                    <button type="submit" class="btn btn-primary">Change password</button>
                                </form>
                            </div>
                        </div>
                        <!-- Delete Account Section -->
                        <div class="card mt-3">
                            <div class="card-body">
                                <h5 class="card-title text-danger">Delete Account</h5>
                                <p class="small text-muted">
                                    Choose what should happen to your data when deleting your account.
                                </p>

                                <form id="deleteAccountForm">
                                    <div class="mb-3">
                                        <div>
                                            <input type="radio" id="keepData" name="deleteOption" value="anonymize" checked>
                                            <label for="keepData">Keep my comments and emails (anonymize)</label>
                                        </div>
                                        <div>
                                            <input type="radio" id="deleteData" name="deleteOption" value="delete">
                                            <label for="deleteData">Delete all my comments and emails</label>
                                        </div>
                                    </div>

                                    <button type="submit" class="btn btn-danger">Delete Account</button>
                                </form>
                            </div>
                        </div>
    </div>
</div>


  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script>
    lucide.createIcons();
  </script>

</div>
{% else %}
    <div>
        <h1>You need to log in in order to use this page</h1>
    </div>
{% endif %}{% endblock %}
